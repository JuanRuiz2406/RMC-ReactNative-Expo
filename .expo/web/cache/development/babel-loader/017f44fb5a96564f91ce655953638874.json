{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _jsxFileName = \"C:\\\\xampp\\\\htdocs\\\\Front-End-RMC-Expo\\\\App.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useReducer, useMemo } from \"react\";\nimport * as Google from \"expo-google-app-auth\";\nimport * as Facebook from \"expo-facebook\";\nimport { Provider } from 'react-native-paper';\nimport { theme } from \"./components/core/theme\";\nimport { createStackNavigator } from \"@react-navigation/stack\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport { NavBar } from \"./components/Navigators/index\";\nimport { StartScreen, LoginScreen, RegisterScreen, ResetPasswordScreen } from \"./components/Navigators/index\";\nimport AuthStackNavigator from \"./components/Navigators/AuthStackNavigator\";\nimport { AuthContext } from \"./components/contexts/authContext\";\nimport AsyncStorage from '@react-native-community/async-storage';\nimport firebase from 'firebase';\nimport { firebaseConfig } from \"./components/config/firebaseConfig\";\nimport Expo from \"expo\";\nimport { androidClientId } from \"./components/config/superKeyAndroid\";\nimport { iosClientId } from \"./components/config/superKeyIOS\";\nimport { idAppFacebook } from \"./components/config/idKeyFacebook\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\n\nif (!firebase.apps.length) {\n  firebase.initializeApp(firebaseConfig);\n}\n\nvar Stack = createStackNavigator();\nexport default function App() {\n  var initialLoginState = {\n    isLoading: false,\n    userName: null,\n    userToken: null,\n    code: null,\n    apiEmail: null,\n    apiPassword: null\n  };\n\n  var loginReducer = function loginReducer(prevState, action) {\n    switch (action.type) {\n      case \"RETRIEVE_TOKEN\":\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          userToken: action.token,\n          isLoading: false\n        });\n\n      case \"LOGIN\":\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          userName: action.id,\n          userToken: action.token,\n          isLoading: true\n        });\n\n      case \"LOGOUT\":\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          userName: null,\n          userToken: null,\n          isLoading: false\n        });\n\n      case \"REGISTER\":\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          userName: action.id,\n          userToken: action.token,\n          isLoading: true\n        });\n    }\n  };\n\n  var _useReducer = useReducer(loginReducer, initialLoginState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      loginState = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var auth = useMemo(function () {\n    return {\n      login: function login(apiEmail, userName, token) {\n        var userToken;\n        return _regeneratorRuntime.async(function login$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                console.log(userName, apiEmail);\n\n                if (!(userName == apiEmail)) {\n                  _context.next = 22;\n                  break;\n                }\n\n                if (!(token != null)) {\n                  _context.next = 18;\n                  break;\n                }\n\n                _context.prev = 3;\n                userToken = token;\n                console.log(\"user token: \", userToken);\n                _context.next = 8;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('userToken', userToken));\n\n              case 8:\n                _context.next = 10;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('userEmail', userName));\n\n              case 10:\n                _context.next = 15;\n                break;\n\n              case 12:\n                _context.prev = 12;\n                _context.t0 = _context[\"catch\"](3);\n                console.log(_context.t0);\n\n              case 15:\n                dispatch({\n                  type: \"LOGIN\",\n                  id: userName,\n                  token: userToken\n                });\n                _context.next = 20;\n                break;\n\n              case 18:\n                console.log(\"Error en el login\");\n                Alert.alert(\"Error en el login\");\n\n              case 20:\n                _context.next = 24;\n                break;\n\n              case 22:\n                console.log(\"El usuario no esta registrado\");\n                Alert.alert(\"El usuario no esta registrado\");\n\n              case 24:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, null, null, [[3, 12]], Promise);\n      },\n      logout: function logout() {\n        return _regeneratorRuntime.async(function logout$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(AsyncStorage.removeItem('userToken'));\n\n              case 3:\n                _context2.next = 5;\n                return _regeneratorRuntime.awrap(AsyncStorage.removeItem('userEmail'));\n\n              case 5:\n                _context2.next = 10;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.log(_context2.t0);\n\n              case 10:\n                dispatch({\n                  type: \"LOGOUT\"\n                });\n\n              case 11:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, null, null, [[0, 7]], Promise);\n      },\n      register: function register(emailApi, token) {\n        var userToken;\n        return _regeneratorRuntime.async(function register$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(token != null)) {\n                  _context3.next = 16;\n                  break;\n                }\n\n                _context3.prev = 1;\n                userToken = token;\n                console.log(\"user token: \", userToken);\n                _context3.next = 6;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('userToken', userToken));\n\n              case 6:\n                _context3.next = 8;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('userEmail', emailApi));\n\n              case 8:\n                _context3.next = 13;\n                break;\n\n              case 10:\n                _context3.prev = 10;\n                _context3.t0 = _context3[\"catch\"](1);\n                console.log(_context3.t0);\n\n              case 13:\n                dispatch({\n                  type: \"REGISTER\",\n                  id: emailApi,\n                  token: userToken\n                });\n                _context3.next = 17;\n                break;\n\n              case 16:\n                console.log(\"Problemas al registrar usuario, error\");\n\n              case 17:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, null, null, [[1, 10]], Promise);\n      },\n      loginWithGoogle: function loginWithGoogle() {\n        var result;\n        return _regeneratorRuntime.async(function loginWithGoogle$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _context4.next = 3;\n                return _regeneratorRuntime.awrap(Google.logInAsync({\n                  androidClientId: androidClientId,\n                  iosClientId: iosClientId,\n                  scopes: ['profile', 'email']\n                }));\n\n              case 3:\n                result = _context4.sent;\n\n                if (!(result.type === 'success')) {\n                  _context4.next = 13;\n                  break;\n                }\n\n                console.log(result);\n                _context4.next = 8;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('userToken', result.accessToken));\n\n              case 8:\n                _context4.next = 10;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('userEmail', result.user.email));\n\n              case 10:\n                dispatch({\n                  type: \"LOGIN\",\n                  id: result.user.email,\n                  token: result.accessToken\n                });\n                _context4.next = 14;\n                break;\n\n              case 13:\n                console.log(\"Cancelado\");\n\n              case 14:\n                _context4.next = 19;\n                break;\n\n              case 16:\n                _context4.prev = 16;\n                _context4.t0 = _context4[\"catch\"](0);\n                console.log(\"Error\", _context4.t0);\n\n              case 19:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, null, null, [[0, 16]], Promise);\n      },\n      loginWithFacebook: function loginWithFacebook() {\n        var _await$Facebook$logIn, type, token, response, resJSON, message;\n\n        return _regeneratorRuntime.async(function loginWithFacebook$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.prev = 0;\n                _context5.next = 3;\n                return _regeneratorRuntime.awrap(Facebook.initializeAsync({\n                  appId: '<APP_ID>'\n                }));\n\n              case 3:\n                _context5.next = 5;\n                return _regeneratorRuntime.awrap(Facebook.logInWithReadPermissionsAsync({\n                  permissions: ['public_profile', 'email', 'user_friends']\n                }));\n\n              case 5:\n                _await$Facebook$logIn = _context5.sent;\n                type = _await$Facebook$logIn.type;\n                token = _await$Facebook$logIn.token;\n\n                if (!(type === 'success')) {\n                  _context5.next = 23;\n                  break;\n                }\n\n                _context5.next = 11;\n                return _regeneratorRuntime.awrap(fetch(\"https://graph.facebook.com/me?access_token=\" + token + \"&fields=id,name,email,about,picture\"));\n\n              case 11:\n                response = _context5.sent;\n                _context5.t0 = JSON;\n                _context5.next = 15;\n                return _regeneratorRuntime.awrap(response.json());\n\n              case 15:\n                _context5.t1 = _context5.sent;\n                resJSON = _context5.t0.stringify.call(_context5.t0, _context5.t1);\n                console.log(resJSON, \" \");\n                _context5.next = 20;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('userToken', token));\n\n              case 20:\n                dispatch({\n                  type: \"LOGIN\",\n                  id: resJSON.email,\n                  token: token\n                });\n                _context5.next = 24;\n                break;\n\n              case 23:\n                Alert.alert(\"cancel\");\n\n              case 24:\n                _context5.next = 30;\n                break;\n\n              case 26:\n                _context5.prev = 26;\n                _context5.t2 = _context5[\"catch\"](0);\n                message = _context5.t2.message;\n                alert(\"Facebook Login Error: \" + message);\n\n              case 30:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, null, null, [[0, 26]], Promise);\n      }\n    };\n  });\n  useEffect(function () {\n    setTimeout(function _callee() {\n      var userToken, userName;\n      return _regeneratorRuntime.async(function _callee$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              userToken = null;\n              userName = null;\n              _context6.prev = 2;\n              _context6.next = 5;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('userToken'));\n\n            case 5:\n              userToken = _context6.sent;\n              _context6.next = 8;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('userEmail'));\n\n            case 8:\n              userName = _context6.sent;\n              console.log(userToken, userName);\n              _context6.next = 15;\n              break;\n\n            case 12:\n              _context6.prev = 12;\n              _context6.t0 = _context6[\"catch\"](2);\n              console.log(_context6.t0);\n\n            case 15:\n              dispatch({\n                type: \"RETRIEVE_TOKEN\",\n                token: userToken\n              });\n\n            case 16:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, null, [[2, 12]], Promise);\n    }, 1000);\n  }, []);\n\n  if (loginState.isLoading) {\n    return React.createElement(Provider, {\n      theme: theme,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 7\n      }\n    }, React.createElement(NavigationContainer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }\n    }, React.createElement(Stack.Navigator, {\n      initialRouteName: \"ReportsMyCity\",\n      screenOptions: {\n        headerShown: false\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 11\n      }\n    }, React.createElement(Stack.Screen, {\n      name: \"ReportsMyCity\",\n      component: NavBar,\n      options: {\n        headerStyle: {\n          backgroundColor: \"#3E5EAB\"\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 13\n      }\n    }))));\n  }\n\n  return React.createElement(Provider, {\n    theme: theme,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 5\n    }\n  }, React.createElement(AuthContext.Provider, {\n    value: auth,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }\n  }, React.createElement(NavigationContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }, loginState.userToken !== null ? React.createElement(Stack.Navigator, {\n    initialRouteName: \"ReportsMyCity\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }\n  }, React.createElement(Stack.Screen, {\n    name: \"ReportsMyCity\",\n    component: NavBar,\n    options: {\n      headerStyle: {\n        backgroundColor: \"#3E5EAB\"\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 15\n    }\n  })) : React.createElement(Stack.Navigator, {\n    screenOptions: {\n      headerShown: false\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }\n  }, React.createElement(Stack.Screen, {\n    name: \"StartScreen\",\n    component: StartScreen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 15\n    }\n  }), React.createElement(Stack.Screen, {\n    name: \"LoginScreen\",\n    component: LoginScreen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 15\n    }\n  }), React.createElement(Stack.Screen, {\n    name: \"RegisterScreen\",\n    component: RegisterScreen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 15\n    }\n  }), React.createElement(Stack.Screen, {\n    name: \"ResetPasswordScreen\",\n    component: ResetPasswordScreen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 15\n    }\n  })))));\n}\n;","map":{"version":3,"sources":["C:/xampp/htdocs/Front-End-RMC-Expo/App.js"],"names":["React","useState","useEffect","useReducer","useMemo","Google","Facebook","Provider","theme","createStackNavigator","NavigationContainer","NavBar","StartScreen","LoginScreen","RegisterScreen","ResetPasswordScreen","AuthStackNavigator","AuthContext","AsyncStorage","firebase","firebaseConfig","Expo","androidClientId","iosClientId","idAppFacebook","apps","length","initializeApp","Stack","App","initialLoginState","isLoading","userName","userToken","code","apiEmail","apiPassword","loginReducer","prevState","action","type","token","id","loginState","dispatch","auth","login","console","log","setItem","Alert","alert","logout","removeItem","register","emailApi","loginWithGoogle","logInAsync","scopes","result","accessToken","user","email","loginWithFacebook","initializeAsync","appId","logInWithReadPermissionsAsync","permissions","fetch","response","JSON","json","resJSON","stringify","message","setTimeout","getItem","headerShown","headerStyle","backgroundColor"],"mappings":"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","sourcesContent":["//import { StatusBar } from 'expo-status-bar';\r\nimport React, { useState, useEffect, useReducer, useMemo } from \"react\";\r\nimport * as Google from \"expo-google-app-auth\";\r\nimport * as Facebook from \"expo-facebook\";\r\n\r\nimport { Provider } from 'react-native-paper';\r\nimport { theme } from './components/core/theme';\r\nimport { createStackNavigator } from \"@react-navigation/stack\";\r\nimport { NavigationContainer } from \"@react-navigation/native\";\r\nimport { NavBar } from \"./components/Navigators/index\";\r\nimport { StartScreen, LoginScreen, RegisterScreen, ResetPasswordScreen } from \"./components/Navigators/index\";\r\n\r\nimport AuthStackNavigator from \"./components/Navigators/AuthStackNavigator\";\r\nimport { AuthContext } from \"./components/contexts/authContext\";\r\n//Storage\r\nimport AsyncStorage from '@react-native-community/async-storage';\r\n//Login with google and facebook\r\nimport firebase from 'firebase';\r\nimport { firebaseConfig } from \"./components/config/firebaseConfig\";\r\nimport Expo from \"expo\";\r\nimport { androidClientId } from \"./components/config/superKeyAndroid\";\r\nimport { iosClientId } from \"./components/config/superKeyIOS\";\r\nimport { idAppFacebook } from \"./components/config/idKeyFacebook\";\r\nimport { Alert } from \"react-native\";\r\n\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\n\r\n\r\n\r\nconst Stack = createStackNavigator();\r\n\r\nexport default function App() {\r\n\r\n  const initialLoginState = {\r\n    isLoading: false,\r\n    userName: null,\r\n    userToken: null,\r\n    code: null,\r\n    apiEmail: null,\r\n    apiPassword: null,\r\n  };\r\n\r\n  const loginReducer = (prevState, action) => {\r\n    switch (action.type) {\r\n      case \"RETRIEVE_TOKEN\":\r\n        return {\r\n          ...prevState,\r\n          userToken: action.token,\r\n          isLoading: false,\r\n        };\r\n      case \"LOGIN\":\r\n        return {\r\n          ...prevState,\r\n          userName: action.id,\r\n          userToken: action.token,\r\n          isLoading: true,\r\n        };\r\n      case \"LOGOUT\":\r\n        return {\r\n          ...prevState,\r\n          userName: null,\r\n          userToken: null,\r\n          isLoading: false,\r\n        };\r\n      case \"REGISTER\":\r\n        return {\r\n          ...prevState,\r\n          userName: action.id,\r\n          userToken: action.token,\r\n          isLoading: true,\r\n        };\r\n    }\r\n  };\r\n\r\n  const [loginState, dispatch] = useReducer(loginReducer, initialLoginState);\r\n\r\n  const auth = useMemo(() => ({\r\n    login: async (apiEmail, userName, token) => {\r\n      let userToken;\r\n      console.log(userName, apiEmail);\r\n      if (userName == apiEmail) {\r\n        if (token != null) {\r\n          try {\r\n            userToken = token;\r\n            console.log(\"user token: \", userToken);\r\n            await AsyncStorage.setItem('userToken', userToken);\r\n            await AsyncStorage.setItem('userEmail', userName);\r\n          } catch (e) {\r\n            console.log(e);\r\n          }\r\n          dispatch({ type: \"LOGIN\", id: userName, token: userToken });\r\n        } else {\r\n          console.log(\"Error en el login\");\r\n          Alert.alert(\"Error en el login\");\r\n        }\r\n      } else {\r\n        console.log(\"El usuario no esta registrado\");\r\n        Alert.alert(\"El usuario no esta registrado\");\r\n      }\r\n    },\r\n    logout: async () => {\r\n      try {\r\n        await AsyncStorage.removeItem('userToken');\r\n        await AsyncStorage.removeItem('userEmail');\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n      dispatch({ type: \"LOGOUT\" });\r\n    },\r\n    register: async (emailApi, token) => {\r\n      if (token != null) {\r\n        let userToken;\r\n        try {\r\n          userToken = token;\r\n          console.log(\"user token: \", userToken);\r\n          await AsyncStorage.setItem('userToken', userToken);\r\n          await AsyncStorage.setItem('userEmail', emailApi);\r\n        } catch (e) {\r\n          console.log(e);\r\n        }\r\n        dispatch({ type: \"REGISTER\", id: emailApi, token: userToken });\r\n      } else {\r\n        console.log(\"Problemas al registrar usuario, error\");\r\n      }\r\n    },\r\n    loginWithGoogle: async () => {\r\n      try {\r\n        const result = await Google.logInAsync({\r\n          androidClientId: androidClientId,\r\n          iosClientId: iosClientId,\r\n          scopes: ['profile', 'email'],\r\n        });\r\n\r\n        if (result.type === 'success') {\r\n          console.log(result);\r\n          await AsyncStorage.setItem('userToken', result.accessToken);\r\n          await AsyncStorage.setItem('userEmail', result.user.email);\r\n          dispatch({ type: \"LOGIN\", id: result.user.email, token: result.accessToken });\r\n        } else {\r\n          console.log(\"Cancelado\");\r\n        }\r\n      } catch (e) {\r\n        console.log(\"Error\", e);\r\n      }\r\n    },\r\n    loginWithFacebook: async () => {\r\n      try {\r\n        await Facebook.initializeAsync({\r\n          appId: '<APP_ID>',\r\n        });\r\n        const {\r\n          type,\r\n          token,\r\n        } = await Facebook.logInWithReadPermissionsAsync({\r\n          permissions: ['public_profile', 'email', 'user_friends'],\r\n        });\r\n        if (type === 'success') {\r\n          // Get the user's name using Facebook's Graph API\r\n          const response = await fetch(`https://graph.facebook.com/me?access_token=${token}&fields=id,name,email,about,picture`);\r\n          const resJSON = JSON.stringify(await response.json())\r\n          console.log(resJSON, \" \");\r\n          await AsyncStorage.setItem('userToken', token);\r\n          dispatch({ type: \"LOGIN\", id: resJSON.email, token: token });\r\n        } else {\r\n          // type === 'cancel'\r\n          Alert.alert(\"cancel\")\r\n        }\r\n      } catch ({ message }) {\r\n        alert(`Facebook Login Error: ${message}`);\r\n      }\r\n\r\n    },\r\n  }));\r\n\r\n  useEffect(() => {\r\n    setTimeout(async () => {\r\n      let userToken, userName;\r\n      userToken = null;\r\n      userName = null;\r\n      try {\r\n        userToken = await AsyncStorage.getItem('userToken');\r\n        userName = await AsyncStorage.getItem('userEmail');\r\n        console.log(userToken, userName);\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n      dispatch({ type: \"RETRIEVE_TOKEN\", token: userToken });\r\n    }, 1000);\r\n  }, []);\r\n\r\n  if (loginState.isLoading) {\r\n    return (\r\n      <Provider theme={theme}>\r\n        <NavigationContainer>\r\n          <Stack.Navigator initialRouteName=\"ReportsMyCity\" screenOptions={{\r\n            headerShown: false,\r\n          }}>\r\n            <Stack.Screen\r\n              name=\"ReportsMyCity\"\r\n              component={NavBar}\r\n              options={{ headerStyle: { backgroundColor: \"#3E5EAB\" } }}\r\n            />\r\n          </Stack.Navigator>\r\n        </NavigationContainer>\r\n      </Provider>\r\n    );\r\n  }\r\n  return (\r\n    <Provider theme={theme}>\r\n      <AuthContext.Provider value={auth}>\r\n        <NavigationContainer >\r\n          {loginState.userToken !== null ? (\r\n            <Stack.Navigator initialRouteName=\"ReportsMyCity\">\r\n              <Stack.Screen\r\n                name=\"ReportsMyCity\"\r\n                component={NavBar}\r\n                options={{ headerStyle: { backgroundColor: \"#3E5EAB\" } }}\r\n              />\r\n            </Stack.Navigator>\r\n          ) : (\r\n            <Stack.Navigator\r\n              screenOptions={{\r\n                headerShown: false,\r\n              }}\r\n            >\r\n              <Stack.Screen name=\"StartScreen\" component={StartScreen} />\r\n              <Stack.Screen name=\"LoginScreen\" component={LoginScreen} />\r\n              <Stack.Screen name=\"RegisterScreen\" component={RegisterScreen} />\r\n              <Stack.Screen name=\"ResetPasswordScreen\" component={ResetPasswordScreen} />\r\n            </Stack.Navigator>\r\n          )}\r\n        </NavigationContainer>\r\n      </AuthContext.Provider>\r\n    </Provider>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}